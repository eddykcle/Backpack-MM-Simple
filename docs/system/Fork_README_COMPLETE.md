# ç³»çµ±ç®¡ç†å®Œæ•´æŒ‡å—

## ğŸ“‹ ç›®éŒ„

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [ç³»çµ±çµ„ä»¶](#ç³»çµ±çµ„ä»¶)
3. [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
4. [SSHæ–·é–‹é€£æ¥æ”¯æŒ](#sshæ–·é–‹é€£æ¥æ”¯æŒ)
5. [å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹)
6. [é«˜ç´šç”¨æ³•](#é«˜ç´šç”¨æ³•)
7. [é…ç½®æ–‡ä»¶](#é…ç½®æ–‡ä»¶)
8. [èˆ‡å‚³çµ±æ–¹æ¡ˆå°æ¯”](#èˆ‡å‚³çµ±æ–¹æ¡ˆå°æ¯”)
9. [æ¸¬è©¦å’Œé©—è­‰](#æ¸¬è©¦å’Œé©—è­‰)
10. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
11. [æ€§èƒ½å’Œå®‰å…¨è€ƒæ…®](#æ€§èƒ½å’Œå®‰å…¨è€ƒæ…®)
12. [ä½¿ç”¨å»ºè­°](#ä½¿ç”¨å»ºè­°)
13. [éƒ¨ç½²å’Œé‹ç¶­](#éƒ¨ç½²å’Œé‹ç¶­)
14. [æ›´æ–°æ—¥èªŒå’Œæœªä¾†è¨ˆåŠƒ](#æ›´æ–°æ—¥èªŒå’Œæœªä¾†è¨ˆåŠƒ)

---

## æ¦‚è¿°

é€™å¥—æ–°çš„ç³»çµ±ç®¡ç†æ–¹æ¡ˆæ—¨åœ¨æ›¿ä»£å‚³çµ±çš„ `nohup`ï¼Œæä¾›æ›´å°ˆæ¥­ã€çµæ§‹åŒ–çš„æ—¥èªŒç®¡ç†ã€é€²ç¨‹å®ˆè­·å’Œç³»çµ±ç›£æ§åŠŸèƒ½ã€‚ç³»çµ±çš„æ ¸å¿ƒç›®æ¨™æ˜¯ï¼š

- âœ… **å®Œå…¨æ›¿ä»£ nohup** - æ”¯æŒSSHæ–·é–‹å¾Œç¹¼çºŒé‹è¡Œ
- âœ… **è‡ªå‹•é‡å•Ÿæ©Ÿåˆ¶** - é€²ç¨‹å´©æ½°æ™‚è‡ªå‹•æ¢å¾©
- âœ… **å°ˆæ¥­æ—¥èªŒç®¡ç†** - çµæ§‹åŒ–ã€è¼ªè½‰ã€å£“ç¸®
- âœ… **å¯¦æ™‚ç›£æ§å‘Šè­¦** - åŠæ™‚ç™¼ç¾å’Œè™•ç†å•é¡Œ
- âœ… **è³‡æºç®¡ç†** - é˜²æ­¢è³‡æºæ¿«ç”¨

---

## ç³»çµ±çµ„ä»¶

### æ ¸å¿ƒç®¡ç†ç³»çµ±

- **å®ˆè­·é€²ç¨‹ç®¡ç†å™¨** (`core/daemon_manager.py`) - é€²ç¨‹å®ˆè­·å’Œè‡ªå‹•é‡å•Ÿ
- **æ—¥èªŒç®¡ç†å™¨** (`core/log_manager.py`) - çµæ§‹åŒ–æ—¥èªŒå’Œæ—¥èªŒè¼ªè½‰
- **ç³»çµ±ç›£æ§** (`monitoring/monitoring.py`) - è³‡æºç›£æ§å’Œå‘Šè­¦ç³»çµ±

### é…ç½®æ–‡ä»¶

- **å®ˆè­·é€²ç¨‹é…ç½®** (`config/daemon_config.json`) - ç³»çµ±é‹è¡Œåƒæ•¸é…ç½®

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. é«˜ç´šæ—¥èªŒç®¡ç† (`core/log_manager.py`)

#### ä¸»è¦ç‰¹æ€§

- **çµæ§‹åŒ–æ—¥èªŒ**: æ”¯æŒJSONæ ¼å¼çš„çµæ§‹åŒ–æ—¥èªŒï¼Œä¾¿æ–¼ç¨‹åºè§£æ
- **åŸºæ–¼æ™‚é–“çš„è¼ªè½‰**: æ¯å¤©è‡ªå‹•å‰µå»ºæ–°çš„æ—¥èªŒç›®éŒ„ï¼ŒæŒ‰æ—¥æœŸçµ„ç¹”æ—¥èªŒæ–‡ä»¶
- **å£“ç¸®å­˜å„²**: è‡ªå‹•å£“ç¸®èˆŠçš„æ—¥èªŒæ–‡ä»¶ï¼Œç¯€çœç£ç›¤ç©ºé–“
- **å¤šç´šåˆ¥åˆ†é¡**: åˆ†é›¢ä¸€èˆ¬æ—¥èªŒã€éŒ¯èª¤æ—¥èªŒå’Œçµæ§‹åŒ–æ—¥èªŒ
- **ç•°æ­¥å¯«å…¥**: é¿å…æ—¥èªŒå¯«å…¥é˜»å¡ä¸»ç·šç¨‹
- **è‡ªå‹•æ¸…ç†**: å®šæœŸæ¸…ç†è¶…éæŒ‡å®šå¤©æ•¸çš„èˆŠæ—¥èªŒç›®éŒ„
- **æ—¥æœŸç›®éŒ„çµæ§‹**: æ¯å¤©çš„æ—¥èªŒéƒ½ä¿å­˜åœ¨ç¨ç«‹çš„æ—¥æœŸç›®éŒ„ä¸­

#### æ—¥èªŒæ–‡ä»¶çµæ§‹

```
logs/
â”œâ”€â”€ 2025-11-25/                   # ä»Šå¤©çš„æ—¥èªŒç›®éŒ„
â”‚   â”œâ”€â”€ trading_bot.log           # ä¸»è¦æ—¥èªŒæ–‡ä»¶
â”‚   â”œâ”€â”€ trading_bot_errors.log    # éŒ¯èª¤æ—¥èªŒ
â”‚   â”œâ”€â”€ trading_bot_structured.log # çµæ§‹åŒ–æ—¥èªŒ
â”‚   â”œâ”€â”€ bot_stdout.log            # æ¨™æº–è¼¸å‡º
â”‚   â””â”€â”€ bot_stderr.log            # æ¨™æº–éŒ¯èª¤
â”œâ”€â”€ 2025-11-24/                   # æ˜¨å¤©çš„æ—¥èªŒç›®éŒ„ï¼ˆå·²å£“ç¸®ï¼‰
â”‚   â”œâ”€â”€ trading_bot.log.gz
â”‚   â”œâ”€â”€ trading_bot_errors.log.gz
â”‚   â””â”€â”€ ...
â””â”€â”€ process.pid                   # é€²ç¨‹PIDæ–‡ä»¶
```

#### æ—¥èªŒæ¸…ç†ç³»çµ±

ç³»çµ±æœƒè‡ªå‹•æ¸…ç†è¶…éæŒ‡å®šå¤©æ•¸çš„èˆŠæ—¥èªŒç›®éŒ„ï¼ˆé»˜èª2å¤©ï¼‰ï¼š

- **æ¸…ç†é–“éš”**: æ¯24å°æ™‚æª¢æŸ¥ä¸€æ¬¡
- **ä¿ç•™å¤©æ•¸**: é»˜èªä¿ç•™æœ€è¿‘2å¤©çš„æ—¥èªŒ
- **å£“ç¸®ç­–ç•¥**: è‡ªå‹•å£“ç¸®éç•¶å‰æ—¥æœŸçš„æ—¥èªŒæ–‡ä»¶
- **ä¿è­·æ©Ÿåˆ¶**: ä¸æœƒåˆªé™¤æ­£åœ¨ä½¿ç”¨çš„æ—¥èªŒæ–‡ä»¶
- **è¨˜éŒ„è¿½è¹¤**: æ‰€æœ‰æ¸…ç†æ“ä½œéƒ½æœƒè¨˜éŒ„åˆ°çµæ§‹åŒ–æ—¥èªŒä¸­

æ¸…ç†æ—¥èªŒç¤ºä¾‹ï¼š
```
22:00:00 - INFO - {"timestamp": "2025-11-25T22:00:00", "level": "INFO", "logger": "trading_bot_daemon", "message": "å·²æ¸…ç†è¶…é2å¤©çš„èˆŠæ—¥èªŒæª”æ¡ˆ", "data": {"deleted_dirs": 1, "freed_space_mb": 15.2}}
```

### 2. é€²ç¨‹å®ˆè­·ç®¡ç† (`core/daemon_manager.py`)

#### ä¸»è¦ç‰¹æ€§

- **å®ˆè­·é€²ç¨‹åŒ–**: è‡ªå‹•å°‡é€²ç¨‹è½‰ç‚ºå®ˆè­·é€²ç¨‹ï¼Œæ”¯æŒSSHæ–·é–‹å¾Œç¹¼çºŒé‹è¡Œ
- **PIDç®¡ç†**: è‡ªå‹•ç®¡ç†PIDæ–‡ä»¶ï¼Œé˜²æ­¢é‡è¤‡å•Ÿå‹•
- **è‡ªå‹•é‡å•Ÿ**: é€²ç¨‹å´©æ½°æ™‚è‡ªå‹•é‡å•Ÿï¼Œæ”¯æŒé‡è©¦é™åˆ¶
- **å¥åº·æª¢æŸ¥**: å®šæœŸæª¢æŸ¥é€²ç¨‹å¥åº·ç‹€æ…‹
- **è³‡æºç›£æ§**: ç›£æ§é€²ç¨‹çš„CPUå’Œå…§å­˜ä½¿ç”¨
- **å„ªé›…åœæ­¢**: æ”¯æŒSIGTERMå’ŒSIGINTä¿¡è™Ÿè™•ç†

#### å‘½ä»¤è¡Œä½¿ç”¨

```bash
# å•Ÿå‹•å®ˆè­·é€²ç¨‹ï¼ˆæ¨è–¦ä½¿ç”¨è™›æ“¬ç’°å¢ƒä¸­çš„Pythonï¼‰
.venv/bin/python3 core/daemon_manager.py start --daemon

# åœæ­¢å®ˆè­·é€²ç¨‹
.venv/bin/python3 core/daemon_manager.py stop

# é‡å•Ÿå®ˆè­·é€²ç¨‹
.venv/bin/python3 core/daemon_manager.py restart

# æŸ¥çœ‹ç‹€æ…‹
.venv/bin/python3 core/daemon_manager.py status
```

**æ³¨æ„**ï¼šå¦‚æœå·²ç¶“æ¿€æ´»è™›æ“¬ç’°å¢ƒï¼ˆ`source .venv/bin/activate`ï¼‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ `python` æˆ– `python3`ã€‚

### 3. ç³»çµ±ç›£æ§å’Œå‘Šè­¦ (`monitoring/monitoring.py`)

#### ä¸»è¦ç‰¹æ€§

- **ç³»çµ±è³‡æºç›£æ§**: CPUã€å…§å­˜ã€ç£ç›¤ä½¿ç”¨ç‡
- **é€²ç¨‹ç‹€æ…‹ç›£æ§**: ç›£æ§äº¤æ˜“æ©Ÿå™¨äººé€²ç¨‹ç‹€æ…‹
- **ç¶²çµ¡é€£æ¥æª¢æŸ¥**: æª¢æŸ¥é—œéµæœå‹™çš„ç¶²çµ¡é€£æ¥
- **æ€§èƒ½æ•¸æ“šæ”¶é›†**: æ”¶é›†æ­·å²æ€§èƒ½æ•¸æ“š
- **å¤šç¨®å‘Šè­¦æ–¹å¼**: éƒµä»¶ã€Telegramã€Webhook
- **å‘Šè­¦æ­·å²**: è¨˜éŒ„å’Œç®¡ç†å‘Šè­¦æ­·å²

#### æ”¯æŒçš„å‘Šè­¦é¡å‹

- ç³»çµ±è³‡æºå‘Šè­¦ (CPUã€å…§å­˜ã€ç£ç›¤)
- é€²ç¨‹ç‹€æ…‹å‘Šè­¦ (é€²ç¨‹ä¸å­˜åœ¨ã€æ®­å±é€²ç¨‹)
- ç¶²çµ¡é€£æ¥å‘Šè­¦ (æœå‹™ä¸å¯é”)
- è‡ªå®šç¾©å‘Šè­¦

---

## SSHæ–·é–‹é€£æ¥æ”¯æŒ

### ğŸ¯ æ ¸å¿ƒä¿è­‰

**é€™å¥—ç³»çµ±åœ¨æ‚¨æ–·é–‹SSHé€£æ¥å¾Œï¼Œçµ•å°èƒ½å¤ ç¹¼çºŒé‹è¡Œï¼**

é€™æ­£æ˜¯è¨­è¨ˆé€™å€‹ç³»çµ±çš„æ ¸å¿ƒç›®æ¨™ä¹‹ä¸€ - å®Œå…¨æ›¿ä»£ nohup çš„åŠŸèƒ½ï¼Œä¸¦æä¾›æ›´å¯é çš„å®ˆè­·é€²ç¨‹ç®¡ç†ã€‚

### æŠ€è¡“åŸç†

#### 1. çœŸæ­£çš„å®ˆè­·é€²ç¨‹åŒ–

ç³»çµ±ä½¿ç”¨ Unix å®ˆè­·é€²ç¨‹çš„æ¨™æº–åšæ³•ï¼š

```python
if daemonize:
    # å‰µå»ºå­é€²ç¨‹ä¾†é‹è¡Œå®ˆè­·é€²ç¨‹ï¼Œç¢ºä¿SSHæ–·é–‹å¾Œç¹¼çºŒé‹è¡Œ
    daemon_pid = os.fork()
    if daemon_pid > 0:
        # çˆ¶é€²ç¨‹é€€å‡ºï¼Œè®“å­é€²ç¨‹æˆç‚ºå­¤å…’é€²ç¨‹
        self.logger.info("å®ˆè­·é€²ç¨‹å·²å•Ÿå‹•åœ¨å¾Œå°", child_pid=daemon_pid)
        return True
    
    # å­é€²ç¨‹ç¹¼çºŒåŸ·è¡Œ
    os.setsid()  # å‰µå»ºæ–°æœƒè©±ï¼Œè„«é›¢æ§åˆ¶çµ‚ç«¯
    os.umask(0)  # æ¸…é™¤æ–‡ä»¶æ¨¡å¼å‰µå»ºæ©ç¢¼
```

#### 2. æœƒè©±éš”é›¢

- `os.setsid()` å‰µå»ºæ–°çš„æœƒè©±ï¼Œå®Œå…¨è„«é›¢SSHæœƒè©±
- å­é€²ç¨‹æˆç‚ºæœƒè©±é¦–é ˜ï¼Œä¸å†å—SSHé€£æ¥å½±éŸ¿
- å³ä½¿SSHæ–·é–‹ï¼Œé€²ç¨‹ä»ç„¶å±¬æ–¼æ–°çš„æœƒè©±

#### 3. å­¤å…’é€²ç¨‹æ©Ÿåˆ¶

- çˆ¶é€²ç¨‹ç«‹å³é€€å‡ºï¼Œå­é€²ç¨‹æˆç‚ºå­¤å…’é€²ç¨‹
- å­¤å…’é€²ç¨‹æœƒè¢« init é€²ç¨‹ï¼ˆPID 1ï¼‰æ¥ç®¡
- init é€²ç¨‹æœƒè² è²¬æ¸…ç†ï¼Œç¢ºä¿é€²ç¨‹ç©©å®šé‹è¡Œ

### èˆ‡ nohup çš„å°æ¯”

| ç‰¹æ€§ | nohup | æ–°ç³»çµ± | èªªæ˜ |
|------|-------|--------|------|
| SSHæ–·é–‹å¾Œé‹è¡Œ | âœ… | âœ… | å…©è€…éƒ½èƒ½å¯¦ç¾ |
| è‡ªå‹•é‡å•Ÿ | âŒ | âœ… | æ–°ç³»çµ±æ”¯æŒå´©æ½°è‡ªå‹•é‡å•Ÿ |
| å¥åº·ç›£æ§ | âŒ | âœ… | æ–°ç³»çµ±æŒçºŒç›£æ§é€²ç¨‹ç‹€æ…‹ |
| æ—¥èªŒç®¡ç† | âŒ | âœ… | æ–°ç³»çµ±æä¾›å°ˆæ¥­æ—¥èªŒç®¡ç† |
| è³‡æºé™åˆ¶ | âŒ | âœ… | æ–°ç³»çµ±å¯é˜²æ­¢è³‡æºæ¿«ç”¨ |
| ç‹€æ…‹æŸ¥è©¢ | âŒ | âœ… | æ–°ç³»çµ±å¯éš¨æ™‚æŸ¥çœ‹é‹è¡Œç‹€æ…‹ |

---

## å¿«é€Ÿé–‹å§‹

### 1. å®‰è£ä¾è³´

```bash
pip install psutil requests
```

### 2. é…ç½®ç³»çµ±

ç·¨è¼¯ `config/daemon_config.json` æ–‡ä»¶ï¼Œè¨­ç½®æ‚¨çš„äº¤æ˜“åƒæ•¸ï¼š

```json
{
  "python_path": ".venv/bin/python3",
  "script_path": "run.py",
  "working_dir": ".",
  "log_dir": "logs",
  "max_restart_attempts": 3,
  "restart_delay": 60,
  "health_check_interval": 30,
  "memory_limit_mb": 2048,
  "cpu_limit_percent": 80,
  "auto_restart": true,
  "environment": {},
  "bot_args": [
    "--exchange", "backpack",
    "--market-type", "perp",
    "--symbol", "BTC_USDC_PERP",
    "--strategy", "perp_grid",
    "--grid-type", "short",
    "--grid-lower", "78000",
    "--grid-upper", "102000",
    "--grid-num", "80"
  ]
}
```

### 3. å•Ÿå‹•ç³»çµ±

```bash
# å•Ÿå‹•å®ˆè­·é€²ç¨‹ï¼ˆæ¨è–¦ä½¿ç”¨è™›æ“¬ç’°å¢ƒä¸­çš„Pythonï¼‰
.venv/bin/python3 core/daemon_manager.py start --daemon

# æŸ¥çœ‹ç‹€æ…‹
.venv/bin/python3 core/daemon_manager.py status

# åœæ­¢å®ˆè­·é€²ç¨‹
.venv/bin/python3 core/daemon_manager.py stop

# é‡å•Ÿå®ˆè­·é€²ç¨‹
.venv/bin/python3 core/daemon_manager.py restart
```

**æ³¨æ„**ï¼šå¦‚æœå·²ç¶“æ¿€æ´»è™›æ“¬ç’°å¢ƒï¼ˆ`source .venv/bin/activate`ï¼‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š
```bash
python core/daemon_manager.py start --daemon
python core/daemon_manager.py status
```

### 4. å•Ÿå‹•ç›£æ§

```bash
# åœ¨å¦ä¸€å€‹çµ‚ç«¯å•Ÿå‹•ç›£æ§
python monitoring/monitoring.py
```

### 5. èª¿æ•´é‹è¡Œä¸­çš„ç¶²æ ¼ç¯„åœ

å¦‚æœæ©Ÿå™¨äººæ­£åœ¨é‹è¡Œï¼Œå¯ä»¥é€šé CLI èª¿æ•´ç¶²æ ¼ä¸Šä¸‹é™ï¼š

```bash
# é‹è¡ŒCLIæ¨¡å¼
python run.py --cli

# é¸æ“‡é¸å–® 10
# è¼¸å…¥ Web æ§åˆ¶ç«¯åœ°å€: http://127.0.0.1:5000
# è¼¸å…¥æ–°çš„ä¸Šä¸‹é™
```

**è©³ç´°æ­¥é©Ÿèªªæ˜ï¼š**

1. **å•Ÿå‹• CLI æ¨¡å¼**
   ```bash
   python run.py --cli
   ```

2. **é¸æ“‡åŠŸèƒ½é¸å–®**
   - åœ¨é¡¯ç¤ºçš„é¸å–®ä¸­é¸æ“‡ `10`ï¼ˆèª¿æ•´ç¶²æ ¼ç¯„åœåŠŸèƒ½ï¼‰

3. **è¼¸å…¥ Web æ§åˆ¶ç«¯åœ°å€**
   - é€šå¸¸ç‚ºï¼š`http://127.0.0.1:5000`
   - å¦‚æœæ‚¨çš„ Web æœå‹™å™¨é‹è¡Œåœ¨ä¸åŒç«¯å£ï¼Œè«‹ç›¸æ‡‰èª¿æ•´

4. **è¼¸å…¥æ–°çš„ç¶²æ ¼ç¯„åœ**
   - è¼¸å…¥æ–°çš„ç¶²æ ¼ä¸‹é™ï¼ˆä¾‹å¦‚ï¼š75000ï¼‰
   - è¼¸å…¥æ–°çš„ç¶²æ ¼ä¸Šé™ï¼ˆä¾‹å¦‚ï¼š105000ï¼‰

**æ³¨æ„äº‹é …ï¼š**
- æ­¤åŠŸèƒ½åƒ…åœ¨æ©Ÿå™¨äººé‹è¡Œæ™‚å¯ç”¨
- èª¿æ•´ç¶²æ ¼ç¯„åœæœƒå½±éŸ¿ç¾æœ‰çš„è¨‚å–®ç­–ç•¥
- å»ºè­°åœ¨å¸‚å ´æ³¢å‹•è¼ƒå°æ™‚é€²è¡Œèª¿æ•´
- èª¿æ•´å¾Œç³»çµ±æœƒè‡ªå‹•é‡æ–°è¨ˆç®—ç¶²æ ¼ä½ˆå±€

---

## é«˜ç´šç”¨æ³•

### è‡ªå®šç¾©æ—¥èªŒè¨˜éŒ„

```python
from core.log_manager import get_logger

logger = get_logger("my_component")
logger.info("æ™®é€šæ—¥èªŒæ¶ˆæ¯")
logger.error("éŒ¯èª¤æ—¥èªŒ", error_code="E001", details={"field": "value"})
logger.log_structured("INFO", "çµæ§‹åŒ–æ—¥èªŒ", {
    "event": "trade_executed",
    "price": 100.5,
    "quantity": 1.5
})
```

### è‡ªå®šç¾©å‘Šè­¦

```python
from monitoring import SystemMonitor, AlertLevel, AlertType

monitor = SystemMonitor(config)
monitor._create_alert(
    AlertLevel.WARNING,
    AlertType.CUSTOM,
    "è‡ªå®šç¾©å‘Šè­¦",
    "é€™æ˜¯ä¸€å€‹è‡ªå®šç¾©å‘Šè­¦æ¶ˆæ¯",
    {"custom_data": "value"}
)
```

### é…ç½®é€šçŸ¥

ç·¨è¼¯ç›£æ§é…ç½®ä»¥å•Ÿç”¨é€šçŸ¥ï¼š

```json
{
  "notifications": {
    "email": {
      "enabled": true,
      "smtp_server": "smtp.gmail.com",
      "smtp_port": 587,
      "username": "your-email@gmail.com",
      "password": "your-app-password",
      "sender": "your-email@gmail.com",
      "recipients": ["recipient@example.com"]
    },
    "telegram": {
      "enabled": true,
      "bot_token": "your-bot-token",
      "chat_ids": ["your-chat-id"]
    },
    "webhook": {
      "urls": ["https://your-webhook-url.com/alert"]
    }
  }
}
```

---

## é…ç½®æ–‡ä»¶

### å®Œæ•´é…ç½®çµæ§‹

```json
{
  "python_path": ".venv/bin/python3",
  "script_path": "run.py",
  "working_dir": ".",
  "log_dir": "logs",
  "max_restart_attempts": 3,
  "restart_delay": 60,
  "health_check_interval": 30,
  "memory_limit_mb": 2048,
  "cpu_limit_percent": 80,
  "auto_restart": true,
  "environment": {},
  "log_cleanup_interval": 86400,
  "log_retention_days": 2,
  "bot_args": ["--exchange", "backpack", "--symbol", "SOL_USDC"]
}
```

### é…ç½®é …èªªæ˜

- `python_path`: Pythonè§£é‡‹å™¨è·¯å¾‘
- `script_path`: è¦é‹è¡Œçš„ä¸»è…³æœ¬
- `working_dir`: å·¥ä½œç›®éŒ„
- `log_dir`: æ—¥èªŒç›®éŒ„
- `max_restart_attempts`: æœ€å¤§é‡å•Ÿå˜—è©¦æ¬¡æ•¸
- `restart_delay`: é‡å•Ÿå»¶é²ï¼ˆç§’ï¼‰
- `health_check_interval`: å¥åº·æª¢æŸ¥é–“éš”ï¼ˆç§’ï¼‰
- `memory_limit_mb`: å…§å­˜é™åˆ¶ï¼ˆMBï¼‰
- `cpu_limit_percent`: CPUä½¿ç”¨ç‡é™åˆ¶ï¼ˆ%ï¼‰
- `auto_restart`: æ˜¯å¦è‡ªå‹•é‡å•Ÿ
- `environment`: ç’°å¢ƒè®Šé‡
- `log_cleanup_interval`: æ—¥èªŒæ¸…ç†é–“éš”ï¼ˆç§’ï¼Œé»˜èª86400å³24å°æ™‚ï¼‰
- `log_retention_days`: æ—¥èªŒä¿ç•™å¤©æ•¸ï¼ˆé»˜èª2å¤©ï¼‰
- `bot_args`: å‚³éçµ¦è…³æœ¬çš„åƒæ•¸

### æ—¥èªŒæ¸…ç†é…ç½®

æ—¥èªŒæ¸…ç†ç³»çµ±é€šéä»¥ä¸‹é…ç½®é …æ§åˆ¶ï¼š

```json
{
  "log_cleanup_interval": 86400,
  "log_retention_days": 2
}
```

- `log_cleanup_interval`: æ—¥èªŒæ¸…ç†æª¢æŸ¥é–“éš”ï¼ˆç§’ï¼‰
  - è¨­ç½®ç‚º 86400 è¡¨ç¤ºæ¯24å°æ™‚æª¢æŸ¥ä¸€æ¬¡
  - å¯ä»¥æ ¹æ“šéœ€è¦èª¿æ•´æª¢æŸ¥é »ç‡
  
- `log_retention_days`: æ—¥èªŒä¿ç•™å¤©æ•¸
  - è¨­ç½®ç‚º 2 è¡¨ç¤ºä¿ç•™æœ€è¿‘2å¤©çš„æ—¥èªŒ
  - è¶…éæ­¤å¤©æ•¸çš„æ—¥èªŒç›®éŒ„æœƒè¢«è‡ªå‹•æ¸…ç†
  - å»ºè­°æ ¹æ“šç£ç›¤ç©ºé–“å’Œèª¿è©¦éœ€æ±‚èª¿æ•´

---

## èˆ‡å‚³çµ±æ–¹æ¡ˆå°æ¯”

| åŠŸèƒ½ | nohup | æ–°ç³»çµ± | èªªæ˜ |
|------|-------|--------|------|
| æ—¥èªŒç®¡ç† | å–®ä¸€æ–‡ä»¶ï¼Œç„¡è¼ªè½‰ | å¤šæ–‡ä»¶åˆ†é¡ï¼Œè‡ªå‹•è¼ªè½‰å’Œå£“ç¸® | æ›´å°ˆæ¥­çš„æ—¥èªŒç®¡ç† |
| éŒ¯èª¤è™•ç† | stderræ··åˆåœ¨stdout | åˆ†é›¢çš„éŒ¯èª¤æ—¥èªŒæ–‡ä»¶ | æ›´å®¹æ˜“æ’æŸ¥å•é¡Œ |
| é€²ç¨‹å®ˆè­· | éœ€è¦é…åˆ&ä½¿ç”¨ | å…§å»ºå®ˆè­·é€²ç¨‹åŒ– | æ›´å¯é çš„å¾Œå°é‹è¡Œ |
| è‡ªå‹•é‡å•Ÿ | ä¸æ”¯æŒ | æ”¯æŒå´©æ½°è‡ªå‹•é‡å•Ÿ | æé«˜ç³»çµ±ç©©å®šæ€§ |
| å¥åº·ç›£æ§ | ç„¡ | å®Œæ•´çš„ç³»çµ±å’Œé€²ç¨‹ç›£æ§ | åŠæ™‚ç™¼ç¾å•é¡Œ |
| å‘Šè­¦é€šçŸ¥ | ç„¡ | æ”¯æŒéƒµä»¶ã€Telegramã€Webhook | ä¸»å‹•é€šçŸ¥ç®¡ç†å“¡ |
| çµæ§‹åŒ–æ—¥èªŒ | ç„¡ | æ”¯æŒJSONæ ¼å¼çµæ§‹åŒ–æ—¥èªŒ | ä¾¿æ–¼ç¨‹åºè§£æ |
| æ€§èƒ½ç›£æ§ | ç„¡ | æ­·å²æ€§èƒ½æ•¸æ“šæ”¶é›†å’Œåˆ†æ | å„ªåŒ–ç³»çµ±æ€§èƒ½ |
| SSHæ–·é–‹å¾Œé‹è¡Œ | âœ… | âœ… | å…©è€…éƒ½èƒ½å¯¦ç¾ |
| ç‹€æ…‹æŸ¥è©¢ | âŒ | âœ… | æ–°ç³»çµ±å¯éš¨æ™‚æŸ¥çœ‹é‹è¡Œç‹€æ…‹ |

---

## æ¸¬è©¦å’Œé©—è­‰

### æ–¹æ³•ä¸€ï¼šç°¡å–®æ¸¬è©¦

```bash
# 1. å•Ÿå‹•å®ˆè­·é€²ç¨‹
.venv/bin/python3 core/daemon_manager.py start --daemon

# 2. æŸ¥çœ‹ç‹€æ…‹ï¼ˆç¢ºèªé‹è¡Œä¸­ï¼‰
.venv/bin/python3 core/daemon_manager.py status

# 3. ç›´æ¥é—œé–‰SSHé€£æ¥
# 4. é‡æ–°é€£æ¥SSH
# 5. å†æ¬¡æŸ¥çœ‹ç‹€æ…‹
.venv/bin/python3 core/daemon_manager.py status
```

### æ–¹æ³•äºŒï¼šè©³ç´°é©—è­‰

```bash
# 1. å•Ÿå‹•å®ˆè­·é€²ç¨‹
.venv/bin/python3 core/daemon_manager.py start --daemon

# 2. è¨˜éŒ„é€²ç¨‹ä¿¡æ¯
ps aux | grep run.py
# è¨˜ä¸‹PIDè™Ÿç¢¼

# 3. æŸ¥çœ‹é€²ç¨‹çš„æœƒè©±ID
ps -o pid,ppid,sid,cmd -p <PID>

# 4. æ–·é–‹SSHé€£æ¥
# 5. é‡æ–°é€£æ¥
# 6. æª¢æŸ¥é€²ç¨‹æ˜¯å¦é‚„åœ¨
ps -p <PID>
# æ‡‰è©²èƒ½çœ‹åˆ°é€²ç¨‹ä»åœ¨é‹è¡Œ

# 7. æŸ¥çœ‹æ—¥èªŒ
tail -f logs/$(date +%Y-%m-%d)/trading_bot.log
```

### æ–¹æ³•å››ï¼šé©—è­‰æ—¥èªŒæ¸…ç†ç³»çµ±

```bash
# 1. å•Ÿå‹•å®ˆè­·é€²ç¨‹
.venv/bin/python3 core/daemon_manager.py start --daemon

# 2. æª¢æŸ¥æ—¥èªŒç›®éŒ„çµæ§‹
ls -la logs/
# æ‡‰è©²çœ‹åˆ°æŒ‰æ—¥æœŸçµ„ç¹”çš„ç›®éŒ„çµæ§‹

# 3. å‰µå»ºæ¸¬è©¦çš„èˆŠæ—¥èªŒç›®éŒ„ï¼ˆç”¨æ–¼æ¸¬è©¦æ¸…ç†åŠŸèƒ½ï¼‰
mkdir -p "logs/$(date -d '3 days ago' +%Y-%m-%d)"
echo "test old log" > "logs/$(date -d '3 days ago' +%Y-%m-%d)/test.log"

# 4. è‡¨æ™‚ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°‡ä¿ç•™å¤©æ•¸è¨­ç‚º1å¤©
sed -i 's/"log_retention_days": 2/"log_retention_days": 1/' config/daemon_config.json

# 5. é‡å•Ÿå®ˆè­·é€²ç¨‹ä»¥æ‡‰ç”¨æ–°é…ç½®
.venv/bin/python3 core/daemon_manager.py restart

# 6. ç­‰å¾…æ¸…ç†åŸ·è¡Œï¼ˆæˆ–æ‰‹å‹•è§¸ç™¼æª¢æŸ¥ï¼‰
sleep 5

# 7. æª¢æŸ¥èˆŠæ—¥èªŒæ˜¯å¦è¢«æ¸…ç†
ls -la logs/
# 3å¤©å‰çš„æ—¥èªŒç›®éŒ„æ‡‰è©²å·²è¢«æ¸…ç†

# 8. æ¢å¾©åŸå§‹é…ç½®
sed -i 's/"log_retention_days": 1/"log_retention_days": 2/' config/daemon_config.json

# 9. æŸ¥çœ‹æ¸…ç†æ—¥èªŒ
grep "å·²æ¸…ç†è¶…é" logs/$(date +%Y-%m-%d)/trading_bot_structured.log
```

### æ–¹æ³•äº”ï¼šé©—è­‰æ—¥èªŒè¼ªè½‰å’Œå£“ç¸®

```bash
# 1. å•Ÿå‹•å®ˆè­·é€²ç¨‹
.venv/bin/python3 core/daemon_manager.py start --daemon

# 2. æª¢æŸ¥ç•¶å‰æ—¥èªŒç›®éŒ„
ls -la logs/$(date +%Y-%m-%d)/

# 3. ç­‰å¾…åˆ°ç¬¬äºŒå¤©ï¼ˆæˆ–æ¨¡æ“¬æ—¥æœŸè®Šæ›´ï¼‰
# 4. æª¢æŸ¥æ˜¨å¤©çš„æ—¥èªŒæ˜¯å¦è¢«å£“ç¸®
ls -la logs/$(date -d 'yesterday' +%Y-%m-%d)/
# æ‡‰è©²çœ‹åˆ° .gz æ“´å±•åçš„å£“ç¸®æ–‡ä»¶
```

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ screen/tmux å°æ¯”

```bash
# å‚³çµ±æ–¹å¼ï¼ˆscreenï¼‰
screen -S trading_bot
python run.py --exchange backpack --symbol SOL_USDC
# æŒ‰ Ctrl+A, D è„«é›¢screen

# æ–°æ–¹å¼ï¼ˆå®ˆè­·é€²ç¨‹ï¼‰
.venv/bin/python3 core/daemon_manager.py start --daemon

# å…©ç¨®æ–¹å¼æ–·é–‹SSHå¾Œéƒ½æ‡‰è©²ç¹¼çºŒé‹è¡Œ
```

### ç¢ºèªæ­¥é©Ÿ

è¦ç¢ºèªç³»çµ±èƒ½åœ¨SSHæ–·é–‹å¾Œç¹¼çºŒé‹è¡Œï¼Œè«‹æŒ‰ä»¥ä¸‹æ­¥é©Ÿæ“ä½œï¼š

1. **å•Ÿå‹•å®ˆè­·é€²ç¨‹**
   ```bash
   .venv/bin/python3 core/daemon_manager.py start --daemon
   ```

2. **è¨˜éŒ„é€²ç¨‹ä¿¡æ¯**
   ```bash
   .venv/bin/python3 core/daemon_manager.py status
   # è¨˜ä¸‹PIDè™Ÿç¢¼
   ```

3. **ä¸»å‹•æ–·é–‹SSHé€£æ¥**
   - ç›´æ¥é—œé–‰çµ‚ç«¯çª—å£
   - æˆ–åŸ·è¡Œ `exit` å‘½ä»¤

4. **ç­‰å¾…å¹¾åˆ†é˜**
   - è®“ç³»çµ±æœ‰æ™‚é–“é‹è¡Œ
   - è®“SSHæœƒè©±å®Œå…¨è¶…æ™‚

5. **é‡æ–°é€£æ¥SSH**
   ```bash
   ssh your-server
   ```

6. **æª¢æŸ¥é€²ç¨‹ç‹€æ…‹**
   ```bash
   .venv/bin/python3 core/daemon_manager.py status
   # æ‡‰è©²é¡¯ç¤º "running": true
   ```

7. **é©—è­‰æ—¥èªŒæ›´æ–°**
   ```bash
   tail -n 10 logs/trading_bot.log
   # æ‡‰è©²æœ‰æœ€æ–°çš„æ™‚é–“æˆ³
   ```

å¦‚æœä»¥ä¸Šæ­¥é©Ÿéƒ½æˆåŠŸï¼Œèªªæ˜ç³»çµ±å®Œå…¨èƒ½å¤ åœ¨SSHæ–·é–‹å¾Œç¹¼çºŒç©©å®šé‹è¡Œï¼

---

## æ•…éšœæ’é™¤

### å•é¡Œï¼šSSHæ–·é–‹å¾Œé€²ç¨‹æ¶ˆå¤±

**å¯èƒ½åŸå› ï¼š**
1. æ²’æœ‰ä½¿ç”¨ `--daemon` åƒæ•¸
2. ç³»çµ±æ®ºæ­»äº†é€²ç¨‹ï¼ˆå…§å­˜ä¸è¶³ç­‰ï¼‰
3. ç¨‹åºæœ¬èº«å´©æ½°

**è§£æ±ºæ–¹æ³•ï¼š**
```bash
# æŸ¥çœ‹ç³»çµ±æ—¥èªŒ
journalctl -xe | grep python
# æˆ–
dmesg | grep -i kill

# æª¢æŸ¥ç¨‹åºæ—¥èªŒ
tail -n 50 logs/trading_bot_errors.log
```

### å•é¡Œï¼šç„¡æ³•é‡æ–°é€£æ¥æŸ¥çœ‹ç‹€æ…‹

```bash
# æª¢æŸ¥PIDæ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la logs/process.pid

# æ‰‹å‹•æŸ¥æ‰¾é€²ç¨‹
ps aux | grep run.py | grep -v grep

# å¦‚æœå­˜åœ¨ä½†ç‹€æ…‹å‘½ä»¤å¤±æ•—ï¼Œå¯èƒ½æ˜¯PIDæ–‡ä»¶å•é¡Œ
# æ‰‹å‹•æ¸…ç†å¾Œé‡æ–°å•Ÿå‹•
rm logs/process.pid
.venv/bin/python3 core/daemon_manager.py start --daemon
```

### å•é¡Œï¼šæ—¥èªŒæ–‡ä»¶éå¤§

- ç³»çµ±æœƒè‡ªå‹•æŒ‰æ—¥æœŸçµ„ç¹”æ—¥èªŒæ–‡ä»¶ï¼Œæ¯å¤©å‰µå»ºæ–°ç›®éŒ„
- è‡ªå‹•å£“ç¸®éç•¶å‰æ—¥æœŸçš„æ—¥èªŒæ–‡ä»¶
- è‡ªå‹•æ¸…ç†è¶…éä¿ç•™å¤©æ•¸çš„èˆŠæ—¥èªŒç›®éŒ„ï¼ˆé»˜èª2å¤©ï¼‰
- å¯ä»¥é€šéèª¿æ•´ `log_retention_days` é…ç½®é …ä¾†æ”¹è®Šä¿ç•™ç­–ç•¥

### å•é¡Œï¼šæ—¥èªŒæ¸…ç†æœªåŸ·è¡Œ

**å¯èƒ½åŸå› ï¼š**
1. å®ˆè­·é€²ç¨‹æœªå•Ÿå‹•æˆ–å·²åœæ­¢
2. é…ç½®æ–‡ä»¶ä¸­çš„ `log_cleanup_interval` è¨­ç½®éå¤§
3. æ²’æœ‰è¶…éä¿ç•™å¤©æ•¸çš„æ—¥èªŒç›®éŒ„

**è§£æ±ºæ–¹æ³•ï¼š**
```bash
# 1. æª¢æŸ¥å®ˆè­·é€²ç¨‹ç‹€æ…‹
.venv/bin/python3 core/daemon_manager.py status

# 2. æŸ¥çœ‹çµæ§‹åŒ–æ—¥èªŒä¸­çš„æ¸…ç†è¨˜éŒ„
grep "å·²æ¸…ç†è¶…é" logs/$(date +%Y-%m-%d)/trading_bot_structured.log

# 3. æ‰‹å‹•è§¸ç™¼æ—¥èªŒæ¸…ç†ï¼ˆé‡å•Ÿå®ˆè­·é€²ç¨‹ï¼‰
.venv/bin/python3 core/daemon_manager.py restart

# 4. æª¢æŸ¥é…ç½®æ–‡ä»¶
cat config/daemon_config.json | grep -E "(log_cleanup_interval|log_retention_days)"
```

### å•é¡Œï¼šæ—¥èªŒç›®éŒ„çµæ§‹æ··äº‚

**æ­£å¸¸çµæ§‹ï¼š**
```
logs/
â”œâ”€â”€ 2025-11-25/    # ä»Šå¤©çš„æ—¥èªŒ
â”œâ”€â”€ 2025-11-24/    # æ˜¨å¤©çš„æ—¥èªŒ
â””â”€â”€ process.pid    # PIDæ–‡ä»¶
```

**å¦‚æœç™¼ç¾èˆŠçš„æ—¥èªŒæ–‡ä»¶ç›´æ¥åœ¨logsç›®éŒ„ä¸‹ï¼š**
```bash
# 1. åœæ­¢å®ˆè­·é€²ç¨‹
.venv/bin/python3 core/daemon_manager.py stop

# 2. æ‰‹å‹•æ•´ç†èˆŠæ—¥èªŒï¼ˆå¯é¸ï¼‰
mkdir -p logs/legacy
mv logs/*.log logs/legacy/ 2>/dev/null || true

# 3. é‡æ–°å•Ÿå‹•å®ˆè­·é€²ç¨‹
.venv/bin/python3 core/daemon_manager.py start --daemon
```

### å•é¡Œï¼šé€²ç¨‹ç„¡æ³•å•Ÿå‹•

- æª¢æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾‘æ˜¯å¦æ­£ç¢º
- æŸ¥çœ‹ `logs/trading_bot_errors.log` ä¸­çš„éŒ¯èª¤ä¿¡æ¯
- ç¢ºä¿æœ‰è¶³å¤ çš„ç³»çµ±è³‡æº

### å•é¡Œï¼šç›£æ§å‘Šè­¦éæ–¼é »ç¹

- èª¿æ•´ç›£æ§é–¾å€¼é…ç½®
- å¢åŠ æª¢æŸ¥é–“éš”æ™‚é–“
- è¨­ç½®å‘Šè­¦å†·å»æ™‚é–“

### æ³¨æ„äº‹é …

#### 1. PIDæ–‡ä»¶ç®¡ç†
- ç³»çµ±æœƒè‡ªå‹•å‰µå»º `logs/process.pid` æ–‡ä»¶
- ä¸è¦æ‰‹å‹•åˆªé™¤é€™å€‹æ–‡ä»¶
- å¦‚æœç•°å¸¸åœæ­¢ï¼Œå¯èƒ½éœ€è¦æ‰‹å‹•æ¸…ç†PIDæ–‡ä»¶

#### 2. ç«¯å£ä½”ç”¨
- ç¢ºä¿ç«¯å£ 5000 å¯ç”¨ï¼ˆWebç•Œé¢ï¼‰
- å¦‚æœè¢«ä½”ç”¨ï¼Œç³»çµ±æœƒè‡ªå‹•å°‹æ‰¾å…¶ä»–ç«¯å£

#### 3. æ–‡ä»¶æ¬Šé™
- ç¢ºä¿ç•¶å‰ç”¨æˆ¶æœ‰æ¬Šé™å¯«å…¥ `logs/` ç›®éŒ„
- ç¢ºä¿æœ‰åŸ·è¡ŒPythonè…³æœ¬çš„æ¬Šé™

#### 4. ç³»çµ±è³‡æº
- ç›£æ§å…§å­˜ä½¿ç”¨ï¼Œé˜²æ­¢å…§å­˜æ´©éœ²
- è¨­ç½®åˆç†çš„é‡å•Ÿæ¬¡æ•¸é™åˆ¶

---

## æ€§èƒ½å’Œå®‰å…¨è€ƒæ…®

### æ€§èƒ½å„ªåŒ–

- **æ—¥èªŒç•°æ­¥å¯«å…¥**: ä¸æœƒé˜»å¡ä¸»äº¤æ˜“é‚è¼¯
- **æ™ºèƒ½è¼ªè½‰**: åªåœ¨éœ€è¦æ™‚é€²è¡Œæ—¥èªŒè¼ªè½‰
- **è³‡æºé™åˆ¶**: å¯é…ç½®å…§å­˜å’ŒCPUä½¿ç”¨é™åˆ¶
- **æ¸…ç†ç­–ç•¥**: è‡ªå‹•æ¸…ç†èˆŠæ—¥èªŒï¼Œé˜²æ­¢ç£ç›¤ç©ºé–“è€—ç›¡

### å®‰å…¨å»ºè­°

- ä¿è­·å¥½é…ç½®æ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼ˆAPIå¯†é‘°ã€éƒµä»¶å¯†ç¢¼ç­‰ï¼‰
- è¨­ç½®é©ç•¶çš„æ–‡ä»¶æ¬Šé™ï¼Œé˜²æ­¢æœªæˆæ¬Šè¨ªå•æ—¥èªŒ
- å®šæœŸå¯©æŸ¥å‘Šè­¦é…ç½®ï¼Œé¿å…ä¿¡æ¯æ´©éœ²
- ä½¿ç”¨æ‡‰ç”¨å°ˆç”¨å¯†ç¢¼è€Œéä¸»éƒµä»¶å¯†ç¢¼

---

## ä½¿ç”¨å»ºè­°

1. **ç”Ÿç”¢ç’°å¢ƒ** - å¼·çƒˆå»ºè­°ä½¿ç”¨å®ˆè­·é€²ç¨‹æ¨¡å¼
2. **ç›£æ§é…ç½®** - é…ç½®å‘Šè­¦é€šçŸ¥ä»¥åŠæ™‚ç™¼ç¾å•é¡Œ
3. **è³‡æºé™åˆ¶** - è¨­ç½®åˆç†çš„å…§å­˜å’ŒCPUé™åˆ¶
4. **å®šæœŸç¶­è­·** - å®šæœŸæª¢æŸ¥æ—¥èªŒå’Œç³»çµ±ç‹€æ…‹
5. **å‚™ä»½é…ç½®** - å®šæœŸå‚™ä»½é…ç½®æ–‡ä»¶
6. **æ¸¬è©¦é©—è­‰** - åœ¨ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²å‰ï¼Œå…ˆåœ¨æ¸¬è©¦ç’°å¢ƒé©—è­‰

---

## éƒ¨ç½²å’Œé‹ç¶­

### Uptime Kuma ç›£è½è¨­ç½®

#### åŠŸèƒ½èªªæ˜

ç•¶æ‚¨ä½¿ç”¨å®ˆè­·é€²ç¨‹ç³»çµ±åŸ·è¡Œç­–ç•¥æ™‚ï¼Œç¨‹åºæœƒè‡ªå‹•åœ¨å¾Œå°å•Ÿå‹• Web æœå‹™å™¨ï¼Œæä¾›å¥åº·æª¢æŸ¥ç«¯é»ä¾› Uptime Kuma ç›£è½ã€‚

#### ä½¿ç”¨æ–¹æ³•

**1. åŸ·è¡Œç­–ç•¥å‘½ä»¤**

ä½¿ç”¨daemonç³»çµ±ä¾†ç®¡ç†ç­–ç•¥é€²ç¨‹ï¼ˆæ¨è–¦æ–¹å¼ï¼‰ï¼š

```bash
# ä½¿ç”¨daemonç³»çµ±å•Ÿå‹•ç­–ç•¥
.venv/bin/python3 core/daemon_manager.py start --daemon

# æˆ–è€…æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾‘
.venv/bin/python3 core/daemon_manager.py start --daemon --config config/daemon_config.json

# æˆ–è€…ç›´æ¥åœ¨çµ‚ç«¯åŸ·è¡Œç­–ç•¥ï¼ˆdaemonæœƒè‡ªå‹•ç®¡ç†ï¼‰
python run.py \
  --exchange backpack \
  --market-type perp \
  --symbol BTC_USDC_PERP \
  --strategy perp_grid \
  --grid-type short \
  --grid-lower 78000 \
  --grid-upper 102000 \
  --grid-num 80 \
  --grid-mode geometric \
  --max-position 0.03 \
  --stop-loss 375 \
  --take-profit 500 \
  --duration 1209600 \
  --interval 300
```

**2. Web æœå‹™å™¨è‡ªå‹•å•Ÿå‹•**

åŸ·è¡Œä¸Šè¿°å‘½ä»¤å¾Œï¼Œç¨‹åºæœƒè‡ªå‹•ï¼š
- åœ¨å¾Œå°å•Ÿå‹• Web æœå‹™å™¨ï¼ˆç«¯å£ 5000ï¼‰
- æä¾›å¥åº·æª¢æŸ¥ç«¯é»

**3. å¥åº·æª¢æŸ¥ç«¯é»**

- **å¥åº·æª¢æŸ¥**: `http://localhost:5000/health`
- **è©³ç´°ç‹€æ…‹**: `http://localhost:5000/health/detailed`
- **Web ç•Œé¢**: `http://localhost:5000`

**4. Uptime Kuma è¨­ç½®**

åœ¨ Uptime Kuma ä¸­æ·»åŠ ç›£è½ï¼š

1. æ·»åŠ æ–°çš„ç›£è½
2. ç›£è½é¡å‹é¸æ“‡ "HTTP(s)"
3. URL å¡«å¯«: `http://ä½ çš„æœå‹™å™¨IP:5000/health`
4. è¨­ç½®åˆé©çš„æª¢æŸ¥é–“éš”ï¼ˆå»ºè­° 60 ç§’ï¼‰
5. ä¿å­˜è¨­ç½®

#### éŸ¿æ‡‰èªªæ˜

**ç­–ç•¥é‹è¡Œä¸­ (HTTP 200)**
```json
{
  "status": "healthy",
  "running": true,
  "timestamp": "2024-01-01T12:00:00"
}
```

**ç­–ç•¥åœæ­¢ (HTTP 503)**
```json
{
  "status": "unhealthy", 
  "running": false,
  "timestamp": "2024-01-01T12:00:00"
}
```

#### æ¸¬è©¦åŠŸèƒ½

æ‚¨å¯ä»¥ä½¿ç”¨ curl æ¸¬è©¦å¥åº·æª¢æŸ¥ç«¯é»ï¼š

```bash
# æ¸¬è©¦å¥åº·æª¢æŸ¥ç«¯é»
curl http://localhost:5000/health

# æ¸¬è©¦è©³ç´°ç‹€æ…‹ç«¯é»
curl http://localhost:5000/health/detailed
```

#### æ³¨æ„äº‹é …

1. **ç«¯å£è¡çª**: å¦‚æœç«¯å£ 5000 è¢«å ç”¨ï¼Œæœå‹™å™¨æœƒè‡ªå‹•å°‹æ‰¾å…¶ä»–å¯ç”¨ç«¯å£
2. **é˜²ç«ç‰†**: ç¢ºä¿æœå‹™å™¨çš„ 5000 ç«¯å£å°å¤–é–‹æ”¾
3. **é ç¨‹è¨ªå•**: ä½¿ç”¨æœå‹™å™¨IPåœ°å€è€Œé localhost é€²è¡Œé ç¨‹ç›£è½

#### æ•…éšœæ’é™¤

**Web æœå‹™å™¨æœªå•Ÿå‹•**
æª¢æŸ¥æ—¥èªŒä¸­æ˜¯å¦æœ‰ç›¸é—œéŒ¯èª¤ä¿¡æ¯ï¼Œé€šå¸¸æœƒé¡¯ç¤ºï¼š
```
Webæœå‹™å™¨å·²åœ¨å¾Œå°å•Ÿå‹•ï¼Œå¯é€šé http://localhost:5000 è¨ªå•
å¥åº·æª¢æŸ¥ç«¯é»: http://localhost:5000/health
```

**Uptime Kuma é¡¯ç¤ºé›¢ç·š**
1. ç¢ºèª Web æœå‹™å™¨å·²å•Ÿå‹•
2. æª¢æŸ¥ç¶²çµ¡é€£æ¥
3. ç¢ºèª URL æ ¼å¼æ­£ç¢ºï¼š`http://IP:5000/health`

**ç›¸é—œæ–‡ä»¶ä½ç½®**
- **å®ˆè­·é€²ç¨‹ç®¡ç†å™¨**: `core/daemon_manager.py`
- **é…ç½®æ–‡ä»¶**: `config/daemon_config.json`
- **ä¸»ç¨‹åº**: `run.py`
- **Webæœå‹™å™¨**: `web/server.py`

---

### Git Fork å·¥ä½œæµç¨‹è¨­ç½®

#### ç›®æ¨™

- ä¿ç•™æ‚¨å°é …ç›®çš„ä¿®æ”¹ï¼ˆå¥åº·æª¢æŸ¥åŠŸèƒ½ï¼‰
- èƒ½å¤ æŒçºŒå¾åŸå§‹å€‰åº«æ‹‰å–æ›´æ–°
- ç¶­è­·æ‚¨è‡ªå·±çš„ç‰ˆæœ¬æ§åˆ¶

#### æ­¥é©Ÿ 1: Fork åŸå§‹å€‰åº«

1. ç™»éŒ„æ‚¨çš„ GitHub è³¬æˆ¶
2. è¨ªå•åŸå§‹å€‰åº«ï¼šhttps://github.com/yanowo/Backpack-MM-Simple
3. é»æ“Šå³ä¸Šè§’çš„ "Fork" æŒ‰éˆ•
4. é¸æ“‡æ‚¨çš„è³¬æˆ¶ä½œç‚º fork ç›®æ¨™
5. ç­‰å¾… fork å®Œæˆ

#### æ­¥é©Ÿ 2: æ·»åŠ æ‚¨çš„ Fork ä½œç‚ºæ–°é ç¨‹

åœ¨æ‚¨çš„æœ¬åœ°é …ç›®ç›®éŒ„ä¸­åŸ·è¡Œï¼š

```bash
# æ·»åŠ æ‚¨çš„ fork ä½œç‚ºæ–°çš„é ç¨‹å€‰åº«
git remote add myfork https://github.com/ä½ çš„ç”¨æˆ¶å/Backpack-MM-Simple.git

# é©—è­‰é ç¨‹è¨­ç½®
git remote -v
```

#### æ­¥é©Ÿ 3: æäº¤æ‚¨çš„ä¿®æ”¹

```bash
# æ·»åŠ æ‰€æœ‰ä¿®æ”¹çš„æ–‡ä»¶
git add .

# æäº¤æ‚¨çš„ä¿®æ”¹
git commit -m "æ·»åŠ å¥åº·æª¢æŸ¥åŠŸèƒ½ä¾› Uptime Kuma ç›£è½

- ä¿®æ”¹ web/server.py æ·»åŠ å¥åº·æª¢æŸ¥ç«¯é»
- ä¿®æ”¹ run.py åœ¨ terminal åŸ·è¡Œæ™‚è‡ªå‹•å•Ÿå‹• Web æœå‹™å™¨
- æ·»åŠ å¥åº·æª¢æŸ¥ç«¯é» /health å’Œ /health/detailed"
```

#### æ­¥é©Ÿ 4: æ¨é€åˆ°æ‚¨çš„ Fork

```bash
# æ¨é€åˆ°æ‚¨çš„ fork
git push myfork main
```

#### æ­¥é©Ÿ 5: è¨­ç½®ä¸Šæ¸¸å€‰åº«åŒæ­¥

```bash
# æ·»åŠ åŸå§‹å€‰åº«ä½œç‚ºä¸Šæ¸¸
git remote add upstream https://github.com/yanowo/Backpack-MM-Simple.git

# é©—è­‰è¨­ç½®
git remote -v
```

æ‚¨æ‡‰è©²çœ‹åˆ°ï¼š
- `origin` -> åŸå§‹å€‰åº«
- `myfork` -> æ‚¨çš„ fork
- `upstream` -> åŸå§‹å€‰åº«ï¼ˆç”¨æ–¼åŒæ­¥æ›´æ–°ï¼‰

#### å·¥ä½œæµç¨‹

**æ—¥å¸¸é–‹ç™¼**
```bash
# å·¥ä½œä¸¦æäº¤åˆ°æ‚¨çš„ fork
git add .
git commit -m "æ‚¨çš„ä¿®æ”¹æè¿°"
git push myfork main
```

**åŒæ­¥ä¸Šæ¸¸æ›´æ–°**
```bash
# 1. ç²å–ä¸Šæ¸¸æ›´æ–°
git fetch upstream

# 2. åˆ‡æ›åˆ°ä¸»åˆ†æ”¯
git checkout main

# 3. åˆä½µä¸Šæ¸¸æ›´æ–°
git merge upstream/main

# 4. è§£æ±ºå¯èƒ½çš„è¡çªï¼ˆå¦‚æœæœ‰ï¼‰
# 5. æ¨é€æ›´æ–°åˆ°æ‚¨çš„ fork
git push myfork main
```

**é«˜ç´šå·¥ä½œæµç¨‹ï¼ˆä½¿ç”¨ rebase ä¿æŒä¹¾æ·¨æ­·å²ï¼‰**
```bash
# 1. ç²å–ä¸Šæ¸¸æ›´æ–°
git fetch upstream

# 2. å‰µå»ºä¸¦åˆ‡æ›åˆ°æ–°åˆ†æ”¯é€²è¡Œé–‹ç™¼
git checkout -b feature/your-feature

# 3. å·¥ä½œä¸¦æäº¤
git add .
git commit -m "æ‚¨çš„åŠŸèƒ½"

# 4. åˆ‡æ›å›ä¸»åˆ†æ”¯
git checkout main

# 5. é‡æ–°åŸºæ–¼ä¸Šæ¸¸æ›´æ–°
git rebase upstream/main

# 6. åˆä½µæ‚¨çš„åŠŸèƒ½åˆ†æ”¯
git merge feature/your-feature

# 7. æ¨é€åˆ°æ‚¨çš„ fork
git push myfork main
```

#### è¡çªè§£æ±º

ç•¶ä¸Šæ¸¸æœ‰æ›´æ–°ä¸”èˆ‡æ‚¨çš„ä¿®æ”¹è¡çªæ™‚ï¼š

1. **æ‰‹å‹•è§£æ±ºè¡çª**ï¼š
   ```bash
   git merge upstream/main
   # è§£æ±ºè¡çªæ–‡ä»¶
   git add .
   git commit -m "åˆä½µä¸Šæ¸¸æ›´æ–°ä¸¦è§£æ±ºè¡çª"
   ```

2. **ä½¿ç”¨å·¥å…·è¼”åŠ©**ï¼š
   - VS Code æœ‰å…§å»ºçš„è¡çªè§£æ±ºå·¥å…·
   - æˆ–ä½¿ç”¨ `git mergetool`

#### æœ€ä½³å¯¦è¸

**1. å®šæœŸåŒæ­¥**
å»ºè­°æ¯é€±æˆ–æ¯æœˆåŒæ­¥ä¸€æ¬¡ä¸Šæ¸¸æ›´æ–°ï¼Œé¿å…ç´¯ç©å¤ªå¤šè¡çªã€‚

**2. å°æ­¥æäº¤**
ä¿æŒæäº¤å°è€Œå°ˆæ³¨ï¼Œä¾¿æ–¼ç®¡ç†å’Œå›æ»¾ã€‚

**3. æ–‡æª”è¨˜éŒ„**
åœ¨ README æˆ–å–®ç¨çš„æ–‡æª”ä¸­è¨˜éŒ„æ‚¨çš„ä¿®æ”¹ï¼Œä¾¿æ–¼è¿½è¹¤ã€‚

**4. åˆ†æ”¯ç­–ç•¥**
å°æ–¼å¤§å‹ä¿®æ”¹ï¼Œä½¿ç”¨åŠŸèƒ½åˆ†æ”¯ï¼š
```bash
git checkout -b feature/uptime-kuma-integration
# å·¥ä½œ...
git push myfork feature/uptime-kuma-integration
```

#### å¸¸è¦‹å•é¡Œ

**Q: å¦‚ä½•æŸ¥çœ‹å“ªäº›æ–‡ä»¶æœ‰è¡çªï¼Ÿ**
```bash
git status
# æˆ–
git diff --name-only --diff-filter=U
```

**Q: å¦‚ä½•æ”¾æ£„åˆä½µï¼Ÿ**
```bash
git merge --abort
```

**Q: å¦‚ä½•åªç²å–ç‰¹å®šæ–‡ä»¶çš„ä¸Šæ¸¸ç‰ˆæœ¬ï¼Ÿ**
```bash
git checkout upstream/main -- path/to/file
```

---

## æ›´æ–°æ—¥èªŒå’Œæœªä¾†è¨ˆåŠƒ

### v1.1.0 (ç•¶å‰ç‰ˆæœ¬)

- å¯¦ç¾åŸºç¤çš„æ—¥èªŒç®¡ç†ç³»çµ±
- æ·»åŠ é€²ç¨‹å®ˆè­·åŠŸèƒ½
- å¯¦ç¾ç³»çµ±ç›£æ§å’Œå‘Šè­¦
- æ”¯æŒå¤šç¨®é€šçŸ¥æ–¹å¼
- æä¾›å®Œæ•´çš„é…ç½®æ–‡ä»¶æ”¯æŒ
- æ”¯æŒSSHæ–·é–‹å¾Œç¹¼çºŒé‹è¡Œ
- **æ–°å¢**: åŸºæ–¼æ™‚é–“çš„æ—¥èªŒè¼ªè½‰ç³»çµ±
- **æ–°å¢**: æ—¥æœŸç›®éŒ„çµæ§‹çµ„ç¹”ï¼ˆlogs/YYYY-MM-DD/ï¼‰
- **æ–°å¢**: è‡ªå‹•æ—¥èªŒæ¸…ç†åŠŸèƒ½ï¼ˆå¯é…ç½®ä¿ç•™å¤©æ•¸ï¼‰
- **æ–°å¢**: æ—¥èªŒæ–‡ä»¶è‡ªå‹•å£“ç¸®
- **æ–°å¢**: å®ˆè­·é€²ç¨‹é›†æˆæ—¥èªŒæ¸…ç†èª¿åº¦
- **æ–°å¢**: å®Œæ•´çš„æ—¥èªŒæ¸…ç†æ–‡æª”å’Œæ•…éšœæ’é™¤æŒ‡å—

### v1.0.0

- åˆå§‹ç‰ˆæœ¬ç™¼å¸ƒ
- åŸºç¤çš„æ—¥èªŒç®¡ç†ç³»çµ±
- é€²ç¨‹å®ˆè­·åŠŸèƒ½
- ç³»çµ±ç›£æ§å’Œå‘Šè­¦
- å¤šç¨®é€šçŸ¥æ–¹å¼æ”¯æŒ
- å®Œæ•´çš„é…ç½®æ–‡ä»¶æ”¯æŒ
- SSHæ–·é–‹å¾Œç¹¼çºŒé‹è¡Œæ”¯æŒ

### v1.1.0 (2025-11-25) - ç¶²æ ¼ç­–ç•¥é‚Šç•Œè™•ç†åŠŸèƒ½

#### æ–°å¢åŠŸèƒ½
- **æ°¸çºŒç¶²æ ¼é‚Šç•Œè™•ç†æ©Ÿåˆ¶**: ç‚º `strategies/perp_grid_strategy.py` æ·»åŠ äº†å¯é…ç½®çš„é‚Šç•Œè§¸ç™¼è™•ç†åŠŸèƒ½
- **ä¸‰ç¨®è™•ç†ç­–ç•¥**:
  - `emergency_close`: ç·Šæ€¥å¹³å€‰ä¸¦åœæ­¢ç­–ç•¥ï¼ˆé»˜èªï¼‰
  - `adjust_range`: è‡ªå‹•èª¿æ•´ç¶²æ ¼ç¯„åœ
  - `stop_only`: åªåœæ­¢æ–°è¨‚å–®ä½†ä¿ç•™æŒå€‰
- **å®¹å·®æ©Ÿåˆ¶**: æ”¯æŒè¨­ç½®é‚Šç•Œè§¸ç™¼å®¹å·®ï¼Œé¿å…é »ç¹è§¸ç™¼
- **å¯é¸ç¦ç”¨**: å…è¨±ç”¨æˆ¶å®Œå…¨ç¦ç”¨é‚Šç•Œæª¢æŸ¥åŠŸèƒ½

#### æ–°å¢é…ç½®åƒæ•¸
```json
"--boundary-action", "emergency_close",
"--boundary-tolerance", "0.001",
"--enable-boundary-check"
```

#### æŠ€è¡“å¯¦ç¾
- `_check_price_boundaries()`: æª¢æŸ¥ç•¶å‰åƒ¹æ ¼æ˜¯å¦è¶…å‡ºç¶²æ ¼ç¯„åœ
- `_handle_boundary_breach()`: æ ¹æ“šé…ç½®è™•ç†åƒ¹æ ¼è§¸ç¢°ç¶²æ ¼é‚Šç•Œ
- é›†æˆåˆ° `place_limit_orders()` æ–¹æ³•ä¸­ï¼Œåœ¨æ¯æ¬¡è¨‚å–®æ›´æ–°å‰æª¢æŸ¥é‚Šç•Œ

#### ä½¿ç”¨æ–¹æ³•
```bash
# é€šéé…ç½®æ–‡ä»¶èª¿æ•´
# ç·¨è¼¯ config/daemon_config.json

# é€šéå‘½ä»¤è¡Œåƒæ•¸èª¿æ•´
python run.py --exchange backpack --symbol ETH_USDC_PERP --strategy perp_grid --boundary-action adjust_range
```

#### é¢¨éšªæ§åˆ¶æ•ˆæœ
- é˜²æ­¢åƒ¹æ ¼å¤§å¹…åé›¢ç¶²æ ¼ç¯„åœæ™‚çš„æ¥µç«¯æå¤±
- æä¾›éˆæ´»çš„æ‡‰å°ç­–ç•¥ï¼Œé©æ‡‰ä¸åŒå¸‚å ´æƒ…æ³
- åœ¨æ¯æ¬¡è¨‚å–®æ›´æ–°å‰æª¢æŸ¥é‚Šç•Œï¼Œç¢ºä¿åŠæ™‚è™•ç†

### æœªä¾†è¨ˆåŠƒ

- [ ] Webç•Œé¢ç®¡ç†
- [ ] æ›´å¤šäº¤æ˜“æ‰€APIé›†æˆ
- [ ] æ©Ÿå™¨å­¸ç¿’ç•°å¸¸æª¢æ¸¬
- [ ] åˆ†ä½ˆå¼éƒ¨ç½²æ”¯æŒ
- [ ] æ›´å¤šé€šçŸ¥æ¸ é“ï¼ˆSlackã€Discordç­‰ï¼‰
- [ ] æ€§èƒ½å„ªåŒ–å’Œè³‡æºä½¿ç”¨å„ªåŒ–

---

## æ”¯æŒå’Œè²¢ç»

å¦‚æœæ‚¨é‡åˆ°å•é¡Œæˆ–æœ‰æ”¹é€²å»ºè­°ï¼Œè«‹ï¼š

1. æŸ¥çœ‹æ—¥èªŒæ–‡ä»¶äº†è§£è©³ç´°éŒ¯èª¤ä¿¡æ¯
2. æª¢æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¢º
3. ç¢ºä¿æ‰€æœ‰ä¾è³´å·²æ­£ç¢ºå®‰è£
4. æäº¤Issueæˆ–Pull Request

---

## ç›¸é—œéˆæ¥

- [ç­–ç•¥è©³ç´°èªªæ˜](../strategies/) - æ·±å…¥äº†è§£å„ç¨®äº¤æ˜“ç­–ç•¥
- [éƒ¨ç½²é‹ç¶­æŒ‡å—](../deployment/) - æœå‹™å™¨éƒ¨ç½²å’Œç¶­è­·

---

## ç¸½çµ

é€™å¥—æ–°ç³»çµ±ä¸åƒ…èƒ½å¤ åœ¨SSHæ–·é–‹å¾Œç¹¼çºŒé‹è¡Œï¼Œé‚„æä¾›äº†æ¯” nohup æ›´å¼·å¤§çš„åŠŸèƒ½ï¼š

- âœ… **æ–·é–‹SSHå¾Œç¹¼çºŒé‹è¡Œ** - å®Œå…¨æ›¿ä»£ nohup
- âœ… **è‡ªå‹•é‡å•Ÿå´©æ½°çš„é€²ç¨‹** - nohup ç„¡æ³•åšåˆ°
- âœ… **å°ˆæ¥­çš„æ—¥èªŒç®¡ç†** - çµæ§‹åŒ–ã€è¼ªè½‰ã€å£“ç¸®
- âœ… **å¯¦æ™‚ç‹€æ…‹ç›£æ§** - éš¨æ™‚äº†è§£é‹è¡Œæƒ…æ³
- âœ… **ç³»çµ±è³‡æºç›£æ§** - é˜²æ­¢è³‡æºæ¿«ç”¨

æ‚¨ç¾åœ¨å¯ä»¥æ”¾å¿ƒåœ°æ–·é–‹SSHé€£æ¥ï¼Œç³»çµ±æœƒåœ¨å¾Œå°ç©©å®šé‹è¡Œï¼

---

## è¨±å¯è­‰

æœ¬é …ç›®æ¡ç”¨MITè¨±å¯è­‰ï¼Œè©³è¦‹LICENSEæ–‡ä»¶ã€‚
