# å¤šå€‹ Perp Grid Bot åŒæ™‚é‹è¡Œå¯è¡Œæ€§åˆ†æ

## æ—¥æœŸ
2025-11-27

## åˆ†ææ¦‚è¿°
æ ¹æ“šç•¶å‰ codebase åˆ†æé‹è¡Œå¤šå€‹ä¸åŒçš„ perp grid bot åŒæ™‚åŸ·è¡Œçš„å¯è¡Œæ€§å’Œé›£åº¦è©•ä¼°ã€‚

## ç¾ç‹€åˆ†æ

### 1. ç•¶å‰æ¶æ§‹é™åˆ¶
æ‚¨çš„ [`daemon_manager.py`](core/daemon_manager.py:1) ç›®å‰çš„è¨­è¨ˆæ˜¯**å–®ä¸€å¯¦ä¾‹**æ¨¡å¼ï¼š
- ä¸€å€‹ daemon è¿›ç¨‹ç®¡ç†ä¸€å€‹ [`run.py`](run.py:1) è¿›ç¨‹
- [`daemon_config.json`](config/daemon_config.json:1) åªèƒ½é…ç½®å–®ä¸€ç­–ç•¥
- é€²ç¨‹ç®¡ç†ä½¿ç”¨å–®ä¸€ PID æ–‡ä»¶è¿½è¹¤

### 2. é…ç½®ç³»çµ±
æ‚¨å·²ç¶“æœ‰è‰¯å¥½çš„é…ç½®åŸºç¤ï¼š
- æ”¯æŒå¤šé…ç½®æ ¼å¼ï¼ˆ[`_is_multi_config_format()`](core/daemon_manager.py:56)ï¼‰
- æœ‰æ¨¡æ¿ç³»çµ±ï¼ˆ[`config/templates/`](config/templates/:1)ï¼‰
- é…ç½®é©—è­‰æ©Ÿåˆ¶ï¼ˆ[`ConfigManager`](core/config_manager.py:1)ï¼‰

## åŸ·è¡Œé›£åº¦è©•ä¼°

### ğŸ”´ é«˜é›£åº¦é»

1. **é€²ç¨‹éš”é›¢èˆ‡ç®¡ç†**
   - éœ€è¦ç‚ºæ¯å€‹ bot å‰µå»ºç¨ç«‹çš„ daemon è¿›ç¨‹
   - PID æ–‡ä»¶è¡çªå•é¡Œ
   - è³‡æºç«¶çˆ­ï¼ˆCPUã€è¨˜æ†¶é«”ã€ç¶²è·¯ï¼‰

2. **é…ç½®è¡çª**
   - WebSocket é€£æ¥æ•¸é‡é™åˆ¶
   - API é€Ÿç‡é™åˆ¶å…±äº«
   - æ—¥èªŒæ–‡ä»¶è·¯å¾‘è¡çª

3. **è³‡æ–™åº«ç«¶çˆ­**
   - å¤šå€‹ç­–ç•¥åŒæ™‚å¯«å…¥åŒä¸€å€‹è³‡æ–™åº«
   - æŒå€‰è³‡æ–™ä¸€è‡´æ€§å•é¡Œ

### ğŸŸ¡ ä¸­ç­‰é›£åº¦é»

1. **ç›£æ§èˆ‡ç‹€æ…‹ç®¡ç†**
   - éœ€è¦çµ±ä¸€çš„ç‹€æ…‹æŸ¥çœ‹ä»‹é¢
   - å€‹åˆ¥ bot çš„å•Ÿå‹•/åœæ­¢æ§åˆ¶

2. **éŒ¯èª¤è™•ç†**
   - ä¸€å€‹ bot å¤±æ•—ä¸æ‡‰å½±éŸ¿å…¶ä»– bot
   - ç¨ç«‹çš„éŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶

### ğŸŸ¢ ä½é›£åº¦é»

1. **é…ç½®è¤‡ç”¨**
   - æ‚¨çš„æ¨¡æ¿ç³»çµ±å·²ç¶“å¾ˆå®Œå–„
   - ç’°å¢ƒè®Šæ•¸æ”¯æ´è‰¯å¥½

## è§£æ±ºæ–¹æ¡ˆæ¶æ§‹

### 1. å¤šé€²ç¨‹ç®¡ç†å™¨è¨­è¨ˆ

```mermaid
graph TB
    A[MultiDaemonManager] --> B[Bot1 Daemon]
    A --> C[Bot2 Daemon]
    A --> D[Bot3 Daemon]
    
    B --> E[run.py --config bot1.json]
    C --> F[run.py --config bot2.json]
    D --> G[run.py --config bot3.json]
    
    H[Shared Resources] --> I[Database Pool]
    H --> J[Log Manager]
    H --> K[Monitor Dashboard]
```

### 2. å»ºè­°çš„å¯¦æ–½æ­¥é©Ÿ

1. **å‰µå»º MultiDaemonManager**
   - ç®¡ç†å¤šå€‹ daemon è¿›ç¨‹
   - ç‚ºæ¯å€‹ bot åˆ†é…å”¯ä¸€ ID
   - ç¨ç«‹çš„ PID æ–‡ä»¶ç®¡ç†

2. **é…ç½®ç³»çµ±æ”¹é€ **
   - æ”¯æ´ bot å¯¦ä¾‹é…ç½®
   - å‹•æ…‹é…ç½®è¼‰å…¥
   - è³‡æºé™åˆ¶é…ç½®

3. **è³‡æºéš”é›¢**
   - ç¨ç«‹çš„æ—¥èªŒè·¯å¾‘
   - è³‡æ–™åº«é€£æ¥æ± 
   - API é€Ÿç‡é™åˆ¶åˆ†é…

## æŠ€è¡“å¯¦ç¾å»ºè­°

### 1. é€²ç¨‹ç®¡ç†æ”¹é€ 
```python
# æ–°å¢ core/multi_daemon_manager.py
class MultiDaemonManager:
    def __init__(self):
        self.bots = {}  # {bot_id: TradingBotDaemon}
        self.config_dir = Path("config/active")
        
    def start_bot(self, bot_id: str, config_file: str):
        # ç‚ºæ¯å€‹ bot å‰µå»ºç¨ç«‹çš„ daemon
        pass
        
    def stop_bot(self, bot_id: str):
        # åœæ­¢ç‰¹å®š bot
        pass
        
    def list_bots(self):
        # åˆ—å‡ºæ‰€æœ‰é‹è¡Œçš„ bot
        pass
```

### 2. é…ç½®çµæ§‹èª¿æ•´
```json
{
  "bot_id": "eth_perp_grid_1",
  "instance_config": {
    "pid_file": "logs/bots/eth_perp_grid_1.pid",
    "log_dir": "logs/bots/eth_perp_grid_1",
    "port": 5001
  },
  "daemon_config": { ... },
  "exchange_config": { ... },
  "strategy_config": { ... }
}
```

### 3. è³‡æºå…±äº«ç­–ç•¥
- **è³‡æ–™åº«**: ä½¿ç”¨é€£æ¥æ± ï¼Œæ¯å€‹ bot ç¨ç«‹çš„è³‡æ–™è¡¨
- **API é™åˆ¶**: å…¨å±€é€Ÿç‡é™åˆ¶ç®¡ç†å™¨
- **ç›£æ§**: çµ±ä¸€çš„ Web Dashboard

## é¢¨éšªè©•ä¼°

### é«˜é¢¨éšª
- **API é™åˆ¶è¶…æ¨™**: å¤šå€‹ bot å¯èƒ½è§¸ç™¼äº¤æ˜“æ‰€é€Ÿç‡é™åˆ¶
- **æŒå€‰è¡çª**: åŒä¸€äº¤æ˜“å°çš„å¤šå€‹ç­–ç•¥å¯èƒ½ç›¸äº’å¹²æ“¾

### ä¸­é¢¨éšª
- **è³‡æºè€—ç›¡**: è¨˜æ†¶é«”å’Œ CPU ä½¿ç”¨é‡ç·šæ€§å¢é•·
- **è¤‡é›œæ€§å¢åŠ **: æ•…éšœæ’é™¤è®Šå¾—å›°é›£

### ç·©è§£ç­–ç•¥
1. **å¯¦æ–½è³‡æºé…é¡**
2. **å¼·åˆ¶æ€§çš„äº¤æ˜“å°éš”é›¢**
3. **å®Œå–„çš„ç›£æ§å’Œè­¦å ±ç³»çµ±**

## çµè«–

åŸ·è¡Œé›£åº¦ï¼š**ä¸­ç­‰åˆ°åé«˜**

é›–ç„¶æ‚¨çš„ codebase æœ‰è‰¯å¥½çš„åŸºç¤ï¼Œä½†éœ€è¦é€²è¡Œç›¸ç•¶å¤šçš„æ¶æ§‹èª¿æ•´ã€‚å»ºè­°ï¼š

1. **å…ˆå¯¦æ–½æœ€å°å¯è¡Œæ€§ç‰ˆæœ¬**ï¼ˆ2-3 å€‹ botï¼‰
2. **é€æ­¥å¢åŠ åŠŸèƒ½**ï¼ˆç›£æ§ã€ç®¡ç†ä»‹é¢ï¼‰
3. **å……åˆ†æ¸¬è©¦è³‡æºéš”é›¢**
4. **å»ºç«‹å®Œå–„çš„ç›£æ§ç³»çµ±**

é€™æ¨£çš„åŠŸèƒ½æ“´å±•æ˜¯å¯è¡Œçš„ï¼Œä½†éœ€è¦è¬¹æ…çš„è¦åŠƒå’Œå¯¦æ–½ã€‚

## åƒè€ƒæ–‡ä»¶
- [`core/daemon_manager.py`](core/daemon_manager.py:1) - ç•¶å‰å–®ä¸€å¯¦ä¾‹ daemon ç®¡ç†å™¨
- [`config/daemon_config.json`](config/daemon_config.json:1) - å–®ä¸€ç­–ç•¥é…ç½®ç¯„ä¾‹
- [`config/templates/backpack_perp_grid.json`](config/templates/backpack_perp_grid.json:1) - æ°¸çºŒç¶²æ ¼ç­–ç•¥æ¨¡æ¿
- [`strategies/perp_grid_strategy.py`](strategies/perp_grid_strategy.py:1) - æ°¸çºŒç¶²æ ¼ç­–ç•¥å¯¦ç¾