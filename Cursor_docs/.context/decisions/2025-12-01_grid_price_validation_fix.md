# 網格價格驗證異常處理修復

## 背景
- 在 `core/config_manager.py` 第 540-545 行的網格邏輯驗證中，代碼重複調用 `float()` 轉換 `grid_upper_price` 和 `grid_lower_price`
- 即使在之前的驗證循環中（第 514-518 行）已經確定這些值可能無法轉換為浮點數
- 當配置文件包含無效的數字格式時，會拋出未處理的 `ValueError` 異常，導致程序崩潰

## 決策摘要
1. **重用已驗證的浮點數值**
   - 在第一次成功轉換時存儲浮點數值到 `validated_floats` 字典
   - 後續網格邏輯驗證直接使用已驗證的值，避免重複轉換
2. **條件檢查優化**
   - 只有當兩個價格值都成功驗證時才進行邏輯比較
   - 確保不會對無效值進行操作

## 操作流程
1. 配置管理器加載網格策略配置文件
2. 在 `_validate_strategy_config` 方法中進行字段驗證
3. 對於浮點數字段，成功轉換後存儲到 `validated_floats` 字典
4. 網格邏輯驗證時，檢查兩個價格值是否都已驗證
5. 如果都已驗證，比較 `grid_upper_price` 是否大於 `grid_lower_price`

## 風險與建議
- **向後兼容性**: 此修復不會影響現有的有效配置文件
- **性能提升**: 避免重複的 `float()` 轉換，提高驗證效率
- **錯誤處理**: 確保無效輸入不會導致程序崩潰，而是返回適當的錯誤信息

## 常見操作問答
- **問: 如果配置文件中的價格是無效格式會怎麼樣？**
  答: 系統會在第一次驗證時捕獲錯誤並添加到錯誤列表，跳過後續的邏輯驗證，不會拋出異常。

- **問: 這個修復會影響現有的配置文件嗎？**
  答: 不會，只有包含無效數字格式的配置文件會受到影響，但它們本來就會導致程序崩潰。

## 本次代碼更新概括
1. **ConfigManager._validate_strategy_config**: 修復了網格價格驗證中的異常處理問題
2. **驗證邏輯**: 優化了浮點數值驗證和重用機制

### 涉及檔案
- `core/config_manager.py`